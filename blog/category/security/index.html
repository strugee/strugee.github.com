<!DOCTYPE html>
<!--
© Copyright 2012-2016 AJ Jordan
This file is part of strugee.net.
strugee.net is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
strugee.net is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the
GNU Affero General Public License for more details.
You should have received a copy of the GNU Affero General Public License
along with strugee.net.	If not, see <http://www.gnu.org/licenses/>.

-->
<!-- Made and coded by AJ Jordan-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <!-- IE7 support isn't really needed, but this addition is so easy I might as well --><!--[if lte IE 7]> <link rel="stylesheet" href="/css/font-awesome-ie7.min.css"> <![endif]-->
    <link rel="stylesheet" href="/css/main.css"><!--[if gte IE 8]> <link rel="stylesheet" href="/css/ie9.css"> <![endif]-->
    <!-- IndieWeb components, with <3-->
    <link rel="me" href="mailto:alex@strugee.net">
    <link rel="me" href="sms:17607054581">
    <link rel="me" href="xmpp:alex@strugee.net">
    <link rel="me" href="https://github.com/strugee">
    <link rel="me" href="https://twitter.com/strugee2">
    <link rel="me" href="https://plus.google.com/+AlexJordan">
    <link rel="me" href="https://pump.strugee.net/alex">
    <link rel="me" href="https://pod.strugee.net/people/82e1c9a030600133e0ca20474782d58c">
    <link rel="me" href="https://media.strugee.net/u/alex">
    <link rel="me" href="https://twitter.com/strugee2">
    <link rel="me" href="https://plus.google.com/+AlexJordan">
    <link rel="me" href="https://www.instagram.com/strugee2/">
    <title>Posts categorized as "security" - strugee.net</title>
    <!-- TODO: apparently this technically isn't allowed to be relative but it seems to work fine, soooo...-->
    <link rel="alternate" type="application/rss+xml" href="index.rss">
  </head>
  <body>
    <div id="container"><!--[if lt IE 7]><p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.<![endif]-->
      <header>
        <h1 id="topheader">strugee.net</h1>
        <nav id="navbar">
          <ul>
            <li id="navlabel" class="navlink">Nav &nbsp;::</li>
            <li class="navlink"><a href="/">Home</a></li>
            <li class="navlink"><a href="/services">Services</a></li>
            <li class="navlink"><a href="/projects">Projects</a></li>
            <li class="navlink"><a href="/talks">Talks</a></li>
            <li class="navlink"><a href="/gpg">GPG Key</a></li>
            <li class="navlink"><a href="/contact">Contact</a></li>
            <li class="navlink"><a href="/blog/">Blog</a></li>
          </ul>
        </nav>
      </header>
      <div id="content">
        <div class="h-feed">
          <h2 class="p-name">Posts categorized as "security"</h2>
          <article itemscope="itemscope" itemtype="http://schema.org/BlogPosting" class="h-entry"><a href="/blog/2018/01/improving-gpg-security">
              <h2 class="p-name">Improving GPG security</h2></a>
            <p class="post-metadata">Published by <a href="https://strugee.net/" rel="author" class="p-author h-card">AJ Jordan</a> on 
              <time datetime="2018-01-16T23:01:13-07:00"><a href="/blog/2018/01/">January</a> 16, <a href="/blog/2018/">2018</a></time> in <a href="/blog/category/security/" class="p-category">security</a> and <a href="/blog/category/personal/" class="p-category">personal</a>
            </p>
            <div class="e-content"><p>Recently I&#x27;ve been putting some effort into improving the security of my <a href="/gpg">GPG key</a> setup, and I thought I would take a moment to document it since I&#x27;m really excited!</p>
<h2>Nitrokey</h2>
<p>First, and most importantly, I have recently acquired a <a href="https://www.nitrokey.com/">Nitrokey Storage</a>. After I initialized the internal storage keys (which took a <em>really</em> long time), I used <code>gpg --edit-key</code> to edit my local keyring. I selected my first subkey, since in my day-to-day keyring the master key&#x27;s private component is stripped, and issued <code>keytocard</code> to move the subkey to the Nitrokey. Then I repeated the process for the other subkey.</p>
<p>In the middle of this I <em>did</em> run into an annoying issue: GPG was giving me errors about not having a pinentry, even though the <code>pinentry-curses</code> and <code>pinentry-gnome3</code> packages were <em>clearly</em> installed. I had been dealing with this issue pretty much since I set up the system, and I had been working around it by issuing <code>echo &#x22;test&#x22; | gpg2 --pinentry-mode loopback --clearsign &#x3E; /dev/null</code> every time I wanted to perform a key operation. This worked because I was forcing GPG to not use the system pinentry program and instead just prompt directly on the local TTY; since I had put in the password, <code>gpg-agent</code> would then have the password cached for a while so I could do the key operation without GPG needing to prompt for a password (and thus without the pinentry error). However, this didn&#x27;t seem to work for <code>--edit-key</code>, which I found supremely annoying.</p>
<p>However this turned out to be a good thing because it forced me to <em>finally</em> deal with the issue. I tried lots of things in an effort to figure out what was going on: I ran <code>dpkg-reconfigure pinentry-gnome3</code>, <code>dpkg-reconfigure gnupg2</code>, and I even manually ran <code>/usr/bin/pinentry</code> to make sure it was working. Turns out that, like many helpful protocols, the pinentry protocol lets you send <code>HELP</code>, and if you do so you&#x27;ll get back a really nice list of possible commands. I played around with this and was able to get GNOME Shell to prompt me for a password, which was then echoed back to me in the terminal!</p>
<p>Despite feeling cool because of that, I still had the pinentry problem. So finally I just started searching all the GPG manpages for mentions of &#x22;pinentry&#x22;. I looked at <code>gpg(1)</code> first, which was unhelpful, and then I looked at <code>gpgconf(1)</code>. That one was also <em>mostly</em> unhelpful, but the &#x22;SEE ALSO&#x22; section <em>did</em> make me think to look at <code>gpg-agent(1)</code>, where I hit upon the solution. Turns out <code>gpg-agent(1)</code> has a note about pinentry programs right at the very top, in the &#x22;DESCRIPTION&#x22; section:</p>
<blockquote>
<p>Please make sure that a proper pinentry program has been installed under the default filename (which is system dependent) or use the option <code>pinentry-program</code> to specify the full name of that program.</p>
</blockquote>
<p>The mention of the <code>pinentry-program</code> option led me pretty immediately to my solution. I had originally copied my <code>.gnupg</code> directory from my old MacBook Pro, and apparently GPGTools - a Mac package that integrated GPG nicely with the environment (as well as providing a GUI I never used) - had added its own <code>pinentry-program</code> line to <code>gpg-agent.conf</code>. That line pointed at a path installed by GPGTools, which of course didn&#x27;t exist on my new Linux system. As soon as I removed the line, <code>--edit-key</code> worked like a charm. (I&#x27;ve also just added <code>gpg-agent.conf</code> to my <a href="https://github.com/strugee/dots/blob/master/.gnupg/gpg-agent.conf">dotfiles</a> so I notice this kind of thing in the future.)</p>
<p>So far, I&#x27;m really enjoying my Nitrokey. It works really well and the app is pretty good, although the menu can be pretty glitchy sometimes. I&#x27;ve used the password manager for a couple high-security passwords (mostly bank passwords) which is great, and I&#x27;ve switched my two-factor authentication for GitHub from FreeOTP on my phone to the Nitrokey since GitHub is a super important account and I really want to make sure people can&#x27;t push code as me.</p>
<p>There are only two problems I&#x27;ve had with the Nitrokey so far. The first is that it&#x27;s slow. I notice a significant pause when I do any crypto operation, probably somewhere between a half a second to a second. This hits me quite often since I sign all my Git commits; however I suspect I&#x27;ll get used to this, and the security benefits are well worth the wait anyway. The other problem is that the Nitrokey doesn&#x27;t support FIDO U2F authentication. This wasn&#x27;t a surprise (I knew it wouldn&#x27;t when I was shopping models) but is nevertheless a problem I would like to deal with (which means getting a second device). The basic reason is just that U2F is newer than the Nitrokey I have. Other than those, though, I would highly recommend Nitrokey. The device is durable, too - I just carry it around in my pocket. (I briefly considered putting it on my keychain - for those of you who haven&#x27;t met me in person, I have my keychain on an easily-detachable connector attached to a belt loop - but I decided against it because my keychain is kinda hefty.)</p>
<h2>Keybase</h2>
<p>In addition to the Nitrokey, I&#x27;ve also finally started using <a href="https://keybase.io/">Keybase</a>!</p>
<p>For a long time I wasn&#x27;t too sure about Keybase. I felt like people should really be meeting in person and doing keysigning parties, and I didn&#x27;t like that they encourage you to upload a private key to them, even if it&#x27;s password-protected. Eventually I softened my position a little bit and got an invite from <a href="https://keybase.io/yawnbox">Christopher Sheats</a> (back then you needed an invite) but I only made it halfway through the install process before getting distracted and forgetting about it for, you know, several years.</p>
<p>This time, though, I decided to finally get my act together. Do I still kinda think it&#x27;s a bummer that Keybase encourages private key uploads? Sure. Are real-life keysignings better? <em>Absolutely</em>. But even though they&#x27;re better, a lot of experience trying to do them and teach them has thoroughly convinced me that they&#x27;re just too impractical. There are lots of people who might need to at least have <em>some</em> trust in my key - for example, to verify software signatures - and this is a pretty decent solution for them. Not to mention a novel and interesting solution. Plus, it&#x27;s possible to use Keybase in such a way that you&#x27;re not compromising security in any way, which is the way I do it.</p>
<p>So tl;dr: I&#x27;m on the Keybase bandwagon now. <a href="https://keybase.io/strugee">My profile</a> is also now linked to from my <a href="/gpg">GPG keys</a> page.</p>
<h2>Safe for master key</h2>
<p>Finally, my dad&#x27;s wife&#x27;s safe has recently been moved into our house and is conveniently sitting next to my computer. Currently, I keep my master key in a file on a flash drive with an encrypted LUKS container. When I need to access my master key, this file gets unlocked with <code>cryptsetup</code> and then mounted somewhere on my laptop, and I pass the <code>--homedir</code> option to <code>gpg</code> to point it at the mount location. This is better than just keeping the master lying around day-to-day, but still pretty unideal as I&#x27;m exposing it to a potentially compromised, non-airgapped computer. Therefore I plan to get a Raspberry Pi (or something similar) and put it in the safe so I can use it as a fully trusted computer that&#x27;s never been connected to the internet (and is therefore <em>very</em> hard to compromise). I&#x27;ll keep the Pi in the safe to provide greater assurance that it hasn&#x27;t been tampered with, as well as to provide a physical level of redundancy for the key material&#x27;s security. This will hopefully happen Real Soon Now&#x2122; - I can&#x27;t wait!</p>

            </div>
          </article>
          <hr/>
          <article itemscope="itemscope" itemtype="http://schema.org/BlogPosting" class="h-entry"><a href="/blog/2017/10/announcing-filter-other-days">
              <h2 class="p-name">filter-other-days: Artificial Ignorance-compatible logfile date filtering</h2></a>
            <p class="post-metadata">Published by <a href="https://strugee.net/" rel="author" class="p-author h-card">AJ Jordan</a> on 
              <time datetime="2017-10-20T19:19:51-04:00"><a href="/blog/2017/10/">October</a> 20, <a href="/blog/2017/">2017</a></time> in <a href="/blog/category/development/" class="p-category">development</a>, <a href="/blog/category/security/" class="p-category">security</a>, <a href="/blog/category/sysadmin/" class="p-category">sysadmin</a> and <a href="/blog/category/releases/" class="p-category">releases</a>. Last edited 
              <time datetime="2018-01-11T20:10:06.000-07:00">January 11, 2018</time>.
            </p>
            <div class="e-content"><p>I&#x27;ve just published version 1.0 of my latest project, <code>filter-other-days</code> - a shell script to filter logfiles for today&#x27;s date in an Artificial Ignorance-compatible way.</p>
<p>If you haven&#x27;t heard of <a href="http://www.ranum.com/security/computer_security/papers/ai/index.html">Artificial Ignorance</a>, it&#x27;s something you should look into cause it&#x27;s pretty awesome. Here&#x27;s the tl;dr: it doesn&#x27;t make sense to look for all the &#x22;interesting&#x22; things  in logfiles, because it&#x27;s not actually possible to enumerate all the failure conditions of a system. So instead what we do is <em>throw away</em> entries that we&#x27;re <em>sure</em> are just routine. Since we&#x27;ve gotten rid of all the uninteresting entries, whatever is left has to be interesting.</p>
<p>I find this pretty compelling, and decided to start implementing it on my Tor relay. I quickly realized that my ideal workflow would be to configure cron to send me email with a daily report of interesting log entries. However, this presented a problem: how to get just today&#x27;s log entries? I wanted to be able to handle all logfiles at once instead of receiving different reports for different logs, so I had to be able to parse all logfiles in the same way. My relay runs on FreeBSD, so the logs are unstructured text files, and even worse, several daemons (like Tor itself) write timestamps in a different format - this makes parsing all logfiles at once super difficult because I couldn&#x27;t just trivially <code>grep</code> for today&#x27;s date since that would end up dropping legitimate entries from logfiles that formatted their timestamps differently.</p>
<p>I briefly considered trying to write a regex to match all sorts of different timestamp formats, but quickly rejected this idea as too fragile. There are a lot of moving parts in a modern operating system - what if e.g. a daemon changed its defaults about how to format timestamps? Or, more likely, what if I simply missed a particular format present in my logs? Then I&#x27;d be accidentally throwing away an entire logfile. To solve this problem, I decided to apply the same idea behind Artificial Ignorance - if I couldn&#x27;t reliably, 100% match log entries from today&#x27;s date, I could do the next best thing and attempt to discard all entries from <em>other</em> dates. In this case the worst that could happen is me recieving irrelevant information, and I&#x27;d be basically guaranteed to never miss an legitimate entry from today.</p>
<p><code>filter-other-days</code> is a working implementation of this design. Originally I put it with the other random scripts I keep with my <a href="https://github.com/strugee/dots/tree/master/bin">dotfiles</a>, but it quickly became obvious that it was useful as a standalone project. So I <a href="https://github.com/strugee/dots/commit/7dd7e2755c55194cdff1c7b24b24bca72581e346">extracted</a> it into its own repository, which now lives <a href="https://github.com/strugee/filter-other-days">on GitHub</a>. From there I continued to improve the script while adding a test suite and writing extensive documentation (including a Unix manpage - I always feel like a wizardly hacker when writing those things). This took, by my estimation, somewhere between 10 and 15 hours because this is actually a shockingly non-trivial problem, but mostly because regexes are hard.</p>
<p>But today I finally finished! So I&#x27;m super excited to announce that version 1.0 of <code>filter-other-days</code> is now available. You can either clone it from GitHub or download a <a href="https://github.com/strugee/filter-other-days/releases/tag/v1.0.0">tarball</a> (and the accompanying signature, if you want). It works pretty well already, but I have some ideas for future directions the project could go:</p>
<ol>
<li>Logic allowing you to actually specify the date you want to filter for, instead of assuming it&#x27;s today (though you actually can already get this behavior using <code>faketime</code>; that&#x27;s what the test suite does)</li>
<li>Removal of the dependency on GNU <code>seq</code> - this is, to my knowledge, the only non-POSIX requirement of <code>filter-other-days</code></li>
<li>Debian package, maybe?</li>
<li>More log formats (please <a href="https://github.com/strugee/filter-other-days/issues">report bugs</a> if you have formats <code>filter-other-days</code> doesn&#x27;t recognize - which you probably do!)</li>
</ol>
<p>If you find this project useful, let me know! I&#x27;d love to hear about how people are using it. Or if it breaks (or doesn&#x27;t fill your usecases), please <a href="https://github.com/strugee/filter-other-days/issues">report bugs</a> or send patches - I love those, too! Either way, may the logs be with you!</p>

            </div>
          </article>
          <hr/>
          <article itemscope="itemscope" itemtype="http://schema.org/BlogPosting" class="h-entry"><a href="/blog/2017/10/denial-of-service-security-fixes-now-available">
              <h2 class="p-name">pump.io denial-of-service security fixes now available</h2></a>
            <p class="post-metadata">Published by <a href="https://strugee.net/" rel="author" class="p-author h-card">AJ Jordan</a> and cross-posted from <a href="http://pump.io/blog/2017/10/denial-of-service-security-fixes-now-available">here</a> on 
              <time datetime="2017-10-01T17:40:59-04:00"><a href="/blog/2017/10/">October</a> 1, <a href="/blog/2017/">2017</a></time> in <a href="/blog/category/pump.io/" class="p-category">pump.io</a>, <a href="/blog/category/development/" class="p-category">development</a>, <a href="/blog/category/security/" class="p-category">security</a> and <a href="/blog/category/releases/" class="p-category">releases</a>. Last edited 
              <time datetime="2018-01-11T20:10:06.000-07:00">January 11, 2018</time>.
            </p>
            <div class="e-content"><p>Recently some denial-of-service vulnerabilities were discovered in various modules that pump.io indirectly depends on. I&#x27;ve bumped Express and <code>send</code> to pull in patched versions, and I&#x27;ve updated our fork of <code>connect-auth</code> to require a patched version of Connect, too. The remaining vulnerabilities I&#x27;ve confirmed don&#x27;t affect us.</p>
<p>Because of these version bumps, I&#x27;ve just put out security releases which all administrators are encouraged to upgrade to as soon as possible. A semver-major release (5.0.0) was released within the past 6 months so per our <a href="https://github.com/pump-io/pump.io/wiki/Security">security support policy</a> this means there are three new releases:</p>
<ol>
<li>pump.io 5.0.2 replaces 5.0.0 and is available now on npm</li>
<li>pump.io 4.1.3 replaces 4.1.2 and is available now on npm</li>
<li>pump.io 4.0.2 will replace 4.0.1 <strike>and is currently undergoing automated testing (it&#x27;ll be on npm shortly)</strike> <strong>Update:</strong> pump.io 4.0.2 is now on npm</li>
</ol>
<p>As these are security releases we encourage admins to upgrade as soon as possible. If you&#x27;re on 5.0.0 installed via npm - our recommended configuration - you can upgrade by issuing:</p>
<pre><code>$ npm install -g pump.io@5
</code></pre>
<p>If you&#x27;re on 4.1.3, you can upgrade by issuing:</p>
<pre><code>$ npm install -g pump.io@4
</code></pre>
<p>And when 4.0.2 is out, if you&#x27;re on 4.0.1 you can upgrade by issuing:</p>
<pre><code>$ npm install -g pump.io@4.0
</code></pre>
<p>Note though that 4.1.3 is a drop-in replacement for 4.0.2, so you should consider just upgrading to that instead. Or even better, <a href="https://pumpio.readthedocs.io/en/latest/upgrades/4.x-to-5.x.html">upgrade to 5.x</a>!</p>
<p>If you don&#x27;t have an npm-based install, you&#x27;ll have to upgrade however you normally do. How to do this will depend on your particular setup.</p>
<p>As always, if you need help, you should get in touch with <a href="https://github.com/pump-io/pump.io/wiki/Community">the community</a>. I&#x27;d also like to specifically thank <a href="https://identi.ca/jxself">Jason Self</a>, who generously deployed a 24-hour private beta of these fixes on <a href="https://datamost.com/">Datamost</a>. One of the version bumps was ever-so-slightly risky, and being able to test things in production before rolling out patches for the entire network was invaluable. I wouldn&#x27;t be as confident as I am in these releases without his help. So thanks, Jason - I really appreciate it!</p>

            </div>
          </article>
          <hr/>
          <article itemscope="itemscope" itemtype="http://schema.org/BlogPosting" class="h-entry"><a href="/blog/2017/03/default-secure-systems">
              <h2 class="p-name">Default-secure systems</h2></a>
            <p class="post-metadata">Published by <a href="https://strugee.net/" rel="author" class="p-author h-card">AJ Jordan</a> on 
              <time datetime="2017-03-13T15:59:17-05:00"><a href="/blog/2017/03/">March</a> 13, <a href="/blog/2017/">2017</a></time> in <a href="/blog/category/development/" class="p-category">development</a> and <a href="/blog/category/security/" class="p-category">security</a>
            </p>
            <div class="e-content"><p>So recently I presented on <a href="https://strugee.net/presentation-operational-security/">operational security</a> and then started in on the nightmare that is <a href="https://strugee.net/presentation-https-deployment/">HTTPS deployment</a>. And like I did with <a href="https://strugee.net/blog/2017/01/new-programming-language-part-i-handlers">language-level security</a> (I <em>still</em> need to write part 2 of that post), I thought to myself, this is so difficult. Why isn&#x27;t there something that will do this for me? That&#x27;s what my latest project is.</p>
<p>Here&#x27;s the tl;dr:</p>
<pre><code>type(app)
=&#x3E; Django/Express.js/etc. app
secure_system(app)
=&#x3E; Docker image
</code></pre>
<p>Or in other words, you&#x27;ll be able to take an existing web app that you&#x27;ve written, run it through this system, and it will spit out a complete, reasonably-secure system image.</p>
<p>Let&#x27;s step back.</p>
<h2>The status quo</h2>
<p>Currently, when a developer wants to run a web app, they can either use something like Heroku, which is fully manged, or a VM from DigitalOcean or Amazon EC2 or something. There are a variety of reasons you might not want to use Heroku, but the only other option is a VM - and with a VM, you get a bare system where you have to set up everything from scratch. Lots of developers just don&#x27;t have the operational experience to do this properly or securely, but it&#x27;s not like they can go and get an operations team to do it for them. So they end up with systems that may have active security problems as well as little to no defense-in-depth mitigations for when security inevitably fails. Security is just another operational concern the developer has no time and no expertise to deal with, so it just doesn&#x27;t happen. The developer spins up a VM, gets it to where it &#x22;works&#x22; and then moves on. <strong>This is not good enough.</strong></p>
<p>I don&#x27;t want to create a false dichotomy, though: this is not the developer&#x27;s fault. Everyone has conflicting priorities and it&#x27;s unreasonable to expect the developer to spend lots of time learning to administrate systems so that they can then spend even more time, you know, administering systems. The problem is that there just isn&#x27;t enough options available - we have to provide something better.</p>
<h2>A middle ground</h2>
<p>This is what my project is about: creating a middle ground between fully-managed deployment platforms and barebones, setup-from-scratch VMs.</p>
<p>This project rests on the idea that operational security (at least, in a single-server, single-admin context) flows from consistency, least privilege, and proactive, defense-in-depth security measures. Here are a couple core design goals:</p>
<ol>
<li>Meet developers where they are. Configuration management like Puppet is a great way to enforce consistency, but it adds a level of indirection and is just another thing that people running hobbyist projects don&#x27;t have time to learn.</li>
<li>Tight integration with apps - this excludes more obscure types of web applications, but gives us a better footing to set up a solid deployment environment. It also may let us integrate more tightly with things like Content Security Policy in the future.</li>
<li>Support virtual hosting. The ability to run multiple apps while paying for a single VM is a compelling reason people go with VMs over e.g. Heroku - we won&#x27;t be helping anyone if we leave this out.</li>
<li>Upgrades are optional. Any system image created by this project will present a system that is organized and can be maintained and modified by hand without breaking everything.</li>
<li>Upgrades are possible. Tight app framework integration will aid with putting data into well-known places that can be backed up and migrated to a new image generated by a newer version of this system.</li>
<li>Not designed for &#x22;real&#x22; production environments. Any project that has a dedicated operations person should not be using this; they should be rolling their own custom environments with something like Puppet. Accordingly, there won&#x27;t be compromises in security in favor of flexibility - it&#x27;s designed to cover 75% of cases &#x22;pretty well&#x22;, which is still better than the status quo for smaller projects (almost 100% of cases don&#x27;t have any security at all).</li>
</ol>
<p>I&#x27;d also like to highlight one really important decision: the output is complete system images. Probably at first this will mean Docker containers but this could easily be turned into VM images. This is a critical part of the design because it allows us to make broad, sweeping changes - for example, preferring system components written in memory-safe languages, replacing OpenSSL with LibreSSL, or creating systemd unit files that lock down service runtime environments to reduce the impact of a compromise. These improvements aren&#x27;t possible unless we control the whole system. And because upgrades are optional but possible, the developer can get security improvements by &#x22;just&#x22; upgrading a component that they use, in the same way that they&#x27;d upgrade a library or something, as opposed to security being a continuous process they have to worry about. Again, obviously not perfect - but much better than the status quo.</p>
<p>I hope to have a MVP out Real Soon Now&#x2122;. But in the meantime, if you have thoughts, feel free to reach out.</p>

            </div>
          </article>
          <hr/>
          <article itemscope="itemscope" itemtype="http://schema.org/BlogPosting" class="h-entry"><a href="/blog/2017/01/new-programming-language-part-i-handlers">
              <h2 class="p-name">New programming language part I: Handlers</h2></a>
            <p class="post-metadata">Published by <a href="https://strugee.net/" rel="author" class="p-author h-card">AJ Jordan</a> on 
              <time datetime="2017-01-26T10:59:20-05:00"><a href="/blog/2017/01/">January</a> 26, <a href="/blog/2017/">2017</a></time> in <a href="/blog/category/personal/" class="p-category">personal</a> and <a href="/blog/category/security/" class="p-category">security</a>
            </p>
            <div class="e-content"><p>So my latest project at the <a href="https://recurse.com">Recurse Center</a> is a new programming language, as yet unnamed. Basically this was inspired by my <a href="https://strugee.net/presentation-security-design">security design</a> presentation in which I laid out a couple ways you can improve programs&#x27; security designs, like process separation. And it occurred to me: why is this so difficult? Something should be doing this for me. Enter... whatever the hell I end up calling my language.</p>
<p>One of the most important building blocks of the language is something that I&#x27;m currently calling a &#x22;Handler&#x22;. A Handler is basically a segregated piece of application code that handles some task or problem domain. For example, a Handler for outgoing DNS requests (syntax subject to change, obviously):</p>
<pre><code>Handler DNS {
    function getAddressFromHostname(hostname) {
        // Very much pseudocode - all function calls here are example OS calls

        sendDnsQuery(hostname);
        while (!haveDnsResult()) {
            sleep(1);
        }
        
        return getDnsResult();
    }
}
</code></pre>
<p>This Handler has one simple method, <code>getAddressFromHostname()</code>. It sends a DNS query, blocks until it has a result, and then returns the result.</p>
<p>What&#x27;s cool about this Handler is that it will be run in its own process - in other words, each Handler is automatically transformed into a privilege-separated process. However, <code>getAddressFromHostname()</code> can still be called from other, high-level Handlers! The language will do all the data marshalling for you, so from a language perspective it looks like a regular function call even though in practice it&#x27;s going cross-process.</p>
<p>Now, let&#x27;s improve our Handler a little bit. It&#x27;s pretty unfortunate that we can only make one DNS request at a time (since it&#x27;s blocking), so let&#x27;s use an event loop.</p>
<pre><code>Handler DNS is eventLoop {
    function getAddressFromHostname(hostname) {
        // Still pseudocode

        return sendDnsQuery(hostname, function(address) {
            return address;
        });
    }
}
</code></pre>
<p>We specified that the <code>DNS</code> Handler is an event loop, so the language automatically set up a Node-style event loop - we never actually called anything to enter an event loop, it just sort of happened as a construct of the language. Note also the nice async-aware return syntax - the result of <code>sendDnsQuery()</code> is returned to <code>getAddressFromHostname()</code>&#x27;s caller, and the result of <code>sendDnsQuery()</code> is specified by the return value of the anonymous function callback.</p>
<p>We can improve correctness even more by specifying that the Handler is not allowed to make syncronous I/O calls at all:</p>
<pre><code>Handler DNS is eventLoop, async {
    // ...
}
</code></pre>
<p>Handlers let you pick and choose different elements and design choices for different parts of your application. For example, if you had a Handler responsible for processing data, it might make sense to restrict it to being entirely functional:</p>
<pre><code>Handler incomingData is functional {
    // ...
}
</code></pre>
<p>In such a Handler, any functions with side effects wouldn&#x27;t be callable, enforced at compile-time (possibly parse-time, depending on whether I can make it compiled or not given the type system). Perhaps you want to spawn a new sandbox process for each piece of incoming data (OpenSSH does this, for example, when first receiving authentication data from untrusted users):</p>
<pre><code>// The &#x60;ephemeral&#x60; keyword will probably be something better, but for now...
Handler incomingData is functional, ephemeral {
    // ...
}
</code></pre>
<p>If your application requires root - for example, if you were writing an NTP daemon that needed to call <code>setTimeOfDay()</code> - that&#x27;s also specified at the Handler level:</p>
<pre><code>Handler incomingData is root {
    // ...
}
</code></pre>
<p>This should give you some idea of why Handlers are really interesting, even beyond the process separation concept that underlies them. (It&#x27;s also worth noting that while I&#x27;ve focused mostly on daemons, this can also be used to securely implement e.g. <code>file</code>.) I&#x27;m really excited to get these ideas out there so I&#x27;ll stop for now, but pretty soon I&#x27;ll write another blog post talking about the type system.</p>

            </div>
          </article>
          <hr/>
          <div id="pages-footer">
            <p><span class="disabled-arrow">←</span> ⋅ Page 1 out of 2 ⋅ <a href="page/2">→</a></p>
          </div>
        </div>
      </div>
      <footer>
        <p>You may find the source code for this website, licensed to you under the GNU Affero GPL, <a href="https://github.com/strugee/strugee.github.com">on GitHub</a>.</p>
        <p>&copy; Copyright 2012-2018 AJ Jordan.</p>
      </footer>
      <!-- Piwik-->
      <!-- Note that this Piwik instance is self-hosted and so doesn't leak metadata. Also, critically, it respects Do Not Track.-->
      <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u="//piwik.strugee.net/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
      </script>
      <noscript>
        <p><img src="//piwik.strugee.net/piwik.php?idsite=1" style="border:0;" alt=""></p>
      </noscript>
      <!-- End Piwik Code-->
      <div id="toys"><a id="monospace-icon" href="javascript:void(0);" title="Inspired by a forgotten-by-me tilde.club member who (~droob?) was &quot;making [their] life&quot; monospace.">~</a><a id="lightbulb-icon" href="javascript:void(0);">
          <div class="icon-lightbulb"></div></a></div>
      <script type="text/javascript" src="/js/main.js"></script>
      <script type="text/javascript" src="/js/idl.js"></script>
    </div>
  </body>
</html>