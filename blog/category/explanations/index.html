<!DOCTYPE html>
<!--
© Copyright 2012-2018 AJ Jordan
This file is part of strugee.net.
strugee.net is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
strugee.net is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the
GNU Affero General Public License for more details.
You should have received a copy of the GNU Affero General Public License
along with strugee.net.	If not, see <http://www.gnu.org/licenses/>.

-->
<!-- Made and coded by AJ Jordan-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width">
    <link rel="preload" href="https://members.internetdefenseleague.org/include/?url=&amp;campaign=&amp;variant=modal">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="author" href="/humans.txt"><!--[if gte IE 8]> <link rel="stylesheet" href="/css/ie9.css"> <![endif]-->
    <title>Posts categorized as "explanations" - strugee.net</title>
    <!-- TODO: apparently this technically isn't allowed to be relative but it seems to work fine, soooo...-->
    <link rel="alternate" type="application/rss+xml" href="index.rss">
    <!-- IndieWeb components, with <3-->
    <link rel="me" href="mailto:alex@strugee.net">
    <link rel="me" href="sms:17607054581">
    <link rel="me" href="xmpp:alex@strugee.net">
    <link rel="me" href="https://github.com/strugee">
    <link rel="me" href="https://twitter.com/strugee2">
    <link rel="me" href="https://plus.google.com/+AlexJordan">
    <link rel="me" href="https://pump.strugee.net/alex">
    <link rel="me" href="https://pod.strugee.net/people/82e1c9a030600133e0ca20474782d58c">
    <link rel="me" href="https://media.strugee.net/u/alex">
    <link rel="me" href="https://twitter.com/strugee2">
    <link rel="me" href="https://plus.google.com/+AlexJordan">
    <link rel="me" href="https://www.instagram.com/strugee2/">
    <link rel="authorization_endpoint" href="https://indieauth.com/auth">
  </head>
  <body>
    <div id="container">
      <header>
        <h1 id="topheader">strugee.net</h1>
        <nav id="navbar">
          <ul>
            <li id="navlabel" class="navlink">Nav &nbsp;::</li>
            <li class="navlink"><a href="/">Home</a></li>
            <li class="navlink"><a href="/services">Services</a></li>
            <li class="navlink"><a href="/projects">Projects</a></li>
            <li class="navlink"><a href="/talks">Talks</a></li>
            <li class="navlink"><a href="/gpg">GPG Key</a></li>
            <li class="navlink"><a href="/contact">Contact</a></li>
            <li class="navlink"><a href="/blog/">Blog</a></li>
          </ul>
        </nav>
      </header>
      <div id="content">
        <div class="h-feed">
          <h2 class="p-name">Posts categorized as "explanations"</h2>
          <article itemscope="itemscope" itemtype="http://schema.org/BlogPosting" class="h-entry"><a href="/blog/2018/02/how-dns-works">
              <h2 class="p-name">How to evaluate domain registrars: a DNS story</h2></a>
            <p class="post-metadata">Published by <a href="https://strugee.net/" rel="author" class="p-author h-card">AJ Jordan</a> on 
              <time datetime="2018-02-01T00:00:42-04:00"><a href="/blog/2018/02/">February</a> 1, <a href="/blog/2018/">2018</a></time> in <a href="/blog/category/explanations/" class="p-category">explanations</a>
            </p>
            <div class="e-content"><blockquote>
<p><em>Adriel</em>: Any recommendations of where I should buy domain names from?</p>
<p><em>Me</em>: I've heard gandi.net is good and they support free software projects and organizations - I'm on Namecheap at the moment but it's janky and sometimes unreliable, and basically the only reason I'm still with them is inertia</p>
<p><em>Adriel</em>: What makes the difference? Why does it matter where it comes from? I guess a better question is, what am I actually buying when I buy a domain?</p>
<p><em>Narrator</em>: DNS is fraught with peril and complexity, and many hours would go by before Adriel got his answer...</p>
</blockquote>
<p>This is a cleaned-up version of an explanation of how the DNS works and what owning a domain name really means. The original was much worse, because I typed it on my phone into a WhatsApp group chat and didn't edit at all. But you, dear reader, get the new-and-improved version! I'll start with <a href="https://github.com/aarsenault">Adriel</a>'s original question - why does it matter where my domain name comes from - and then transition into talking about how the DNS works and how the domain registar plays into that picture.</p>
<p>Here is, in my <em>highly</em>-opinionated opinion, the golden rule of registrar shopping - the #1 thing you have to know: <em>all registrars are sketchy. Therefore you are looking for the least terrible option.</em></p>
<p>Once you understand this, you're looking at four things registrars have to provide:</p>
<ol>
<li>DNS services</li>
<li>Whois data</li>
<li>The web UI for managing everything</li>
<li>Support</li>
</ol>
<p>These are the most important, but depending on your usecase you might also want to examine value-add services registrars provide. Most registrars will also host your email and provide shared hosting, or sometimes a virtual private server, or VPS. A VPS is a box where you get root and can do whatever you want, including hosting a web server (but you have to do it yourself); shared hosting is where you get a managed web server installation that's shared (get it?) with other people. You get write access to a particular
directory on the box that the web server is configured to serve from. (Registrars often also provide TLS/HTTPS certificates, but now that <a href="https://letsencrypt.org/">Let's Encrypt</a> exists, why you'd pay for one unless you need an <a href="https://en.wikipedia.org/wiki/Extended_Validation_Certificate">EV cert</a> is beyond me.)</p>
<p>The third and fourth responsibilities are pretty easy to understand. Is the web UI butt-ugly or buggy, and is the support staff friendly and responsive. So I want to focus on the first responsibility, DNS, because that can be super confusing (I don't really understand the second, Whois, and anyway this post is long enough already). Here's the tl;dr: the registrar provides the servers that are responsible for answering DNS queries. Even if you use a third-party provider your registrar is involved, because they have to serve <code>NS</code> records that basically say "hey look over at this other provider for the REAL records."</p>
<p>Let's break down exactly what that means. Before I start I should note that if you've ever heard people say something along the lines of, "it'll take up to 24 hours for DNS to propogate," you should forget that. It's a convenient lie that people (including myself sometimes!) use to explain DNS' caching behavior more easily.</p>
<p>DNS works by recursively resolving each component in a domain name. It's probably easiest to demonstrate how this works by walking through the steps clients like browsers take when they're trying to resolve a domain name into a numeric IP address. So say we're trying to resolve <code>example.com</code>, with no help from anybody else.</p>
<p>Our first step is to look up the authoritative nameservers for the <code>com</code> component. In other words, we're looking up the servers that have the absolute final word as to what DNS records <code>com</code> has. (More on exactly how this first step works later.) Once we've found the <code>com</code> nameservers, we issue a DNS query asking them where we can find the nameservers for <code>example.com</code>. The answer we get back will point to <code>example.com</code>'s registrar. Always. Even if they're using a different DNS service - the registar just points to the other service with <code>NS</code> records.</p>
<p>Let's pause in our journey to resolve <code>example.com</code> for a second to consider the implications of this. This means that the registrar is <strong>always</strong> involved in DNS lookups for a domain, which is important for two reasons:</p>
<ol>
<li>If the registrar's DNS goes down so does your website</li>
<li>If you want to use DNSSEC on your domain (which of course I have Opinions™ on but whatever) your registrar has to support it, because the way DNSSEC works is that EVERY link in the lookup chain MUST be signed, or the entire chain of trust falls apart[1]</li>
</ol>
<p>Just things to bear in mind.</p>
<p>Anyway, we're almost done resolving <code>example.com</code>. We've found its nameserver, so all we have to do is issue our original query. Maybe we need an IPv4 address, in which case we'd ask the nameserver for all <code>A</code> records for <code>example.com</code>; maybe we want IPv6 addresses instead in which case we'd ask for <code>AAAA</code> records. (If you want to know more about DNS record types, <a href="https://en.wikipedia.org/wiki/List_of_DNS_record_types">Wikipedia has a nice list</a>!) If the registrar is the authoritative nameserver for <code>example.com</code> it'll respond normally, if <code>example.com</code> uses a 3rd-party DNS host, the registrar will respond with <code>NS</code> records. In the former case, we've gotten the data we originally set out to get; in the latter, we simply issue our query again to the nameserver the registrar pointed us at - which we now know to be authoritative - and if all goes well, we'll get a regular response and be done. As a reminder, the "authoritative nameserver" for a given domain is whatever nameserver contains the authoritative data <strong>for that domain</strong>. So we say e.g. "such-and-such a registrar's nameservers are <em>authoritative for</em> <code>example.com</code>." For <code>example.net</code> the authoritative nameservers could be completely different.</p>
<p>The overarching goal of the recursive resolution procedure I just laid out is simply to find that veeery last nameserver in the chain which can speak authoritatively for the domain we're interested in. Your registar's job, as far as DNS is concerned, is to put the domain in the nameservers for the top-level domain (or TLD - <code>com</code> in <code>example.com</code>'s case) and to either serve regular DNS records or point recursive DNS resolvers at the authoritative nameserver that will. There's also some other paperwork involved I think, but I wouldn't know much about that.</p>
<p>As an aside, I should note that normally, your computer doesn't do all this recursive stuff. There will be some DNS server upstream - perhaps running on your router or run by your ISP - that does it for you. This is to alleviate your computer from having to know how to do this and also because it makes stuff like caching work better. Speaking of caching, let's talk about the <em>real</em> explanation behind the admittedly super-convenient "24 hour propogation" lie. Now that we know how DNS resolution works the idea of "DNS propogation" is pretty simple to understand - it comes from caching. All that recursion stuff is expensive in terms of time (and nameserver load), so we want to avoid doing it whenever possible by generating responses from a local cache. This is accomplished by a Time To Live (TTL) associated with every DNS record response. The TTL basically says how long the record is valid for, and therefore how long it can be cached. When you change your DNS records and wait for it to "propogate", really you're just waiting for caches to expire. That means, though, that if you plan ahead you can lower your TTL to a few seconds, wait until everybody's cache expires (so everyone sees the new TTL), and then make your change[2]. This would lower downtime to a minimum. To be polite you'd then raise your TTL again. If you want to know more about this, <a href="https://serverfault.com/a/125378/167999">here</a> is an excellent Server Fault question that rehashes this explanation and then describes an exponential backoff strategy you might use to make such a change as efficiently as possible.</p>
<p>And with that, we've covered most of what you need to know about how DNS works, except for one thing - that mysterious first step. How did we get the nameservers for <code>com</code>?</p>
<p>The answer is the <a href="https://en.wikipedia.org/wiki/Root_name_server">DNS root</a>. The DNS root servers are at the absolute top of the DNS hierarchy, and they're responsible for resolving TLDs. In fact, if I was to nitpick, I'd point out that I lied earlier when I said we were trying to resolve <code>example.com</code>. In reality, we're trying to resolve <code>example.com.</code> (note the trailing <code>.</code>). If we read this new domain name, which is now <em>fully qualified</em>, from right-to-left, we get the chain we used to lookup the final authoritative nameserver. It goes: empty string, indicating the root "zone" (to use DNS parlance) -> <code>com</code> -> <code>example</code>. DNS is technically distributed but organizationally highly centralized around the DNS root, and trust in the DNS root, and people who don't like that tend to run alternative DNS roots (your friendly author is sympathetic to this position). But that's a story for another time.</p>
<p>Hopefully you now have a much better idea of how the DNS works and why your registrar has to be involved in it. I'm 95% sure this post is accurate, but I could always be wrong so if you spot a mistake, please feel free to contact me either by <a href="/contact">the usual ways</a> or by Zulip if you're a Recurser. Good luck!</p>
<p>Footnotes:</p>
<p> [1]: FWIW this is how Namecheap screwed up my domain - I turned on their DNSSEC option, but they had messed up their signing so that suddenly any resolver which validated DNSSEC would reject the legitimate responses as invalid. This was made extremely difficult to debug by the fact that you don't really know if a resolver is doing this for you, and often if DNSSEC validation fails that failure won't be passed directly on to the client (the client instead will get <code>NXDOMAIN</code> or something, which is basically the DNS way of saying "there's nothing there"). So resolution would fail on half the networks I tested from, with no clear difference. To make matters worse, when I went to turn of Namecheap's DNSSEC support because my website was down for a basically semi-random sampling of my visitors, the change didn't actually propogate to production! Like, I flipped the switch in the admin panel and it literally did <em>nothing</em>. So I had to escalate a support ticket to get them to purge all the DNSSEC stuff from production. Kinda ridiculous!</p>
<p> [2]: do note, however, that <a href="https://serverfault.com/a/740637/167999">people sometimes don't follow the standard</a> and set a lower bound (i.e. minimum) on TTLs. So if you make a change make sure stuff running on your old IP address won't wreak havoc if it gets production traffic.</p>

            </div>
          </article>
          <hr/>
          <div id="pages-footer">
            <p>Page 1 of 1</p>
          </div>
        </div>
      </div>
      <footer>
        <p>You may find the source code for this website, licensed to you under the GNU Affero GPL, <a href="https://github.com/strugee/strugee.github.com">on GitHub</a>.</p>
        <p>&copy; Copyright 2012-2018 AJ Jordan.</p>
      </footer>
      <!-- Piwik-->
      <!-- Note that this Piwik instance is self-hosted and so doesn't leak metadata. Also, critically, it respects Do Not Track.-->
      <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u="//piwik.strugee.net/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
      </script>
      <noscript>
        <p><img src="//piwik.strugee.net/piwik.php?idsite=1" style="border:0;" alt=""></p>
      </noscript>
      <!-- End Piwik Code-->
      <div id="toys"><a id="monospace-icon" href="javascript:void(0);" title="Inspired by a forgotten-by-me tilde.club member who (~droob?) was &quot;making [their] life&quot; monospace.">~</a><a id="lightbulb-icon" href="javascript:void(0);">
          <div class="icon-lightbulb"></div></a></div>
      <script type="text/javascript" src="/js/main.js"></script>
      <script type="text/javascript">
        window._idl = {};
        _idl.variant = "modal";
        (function() {
        	var idl = document.createElement('script');
        	idl.async = true;
        	idl.src = 'https://members.internetdefenseleague.org/include/?url=' + (_idl.url || '') + '&campaign=' + (_idl.campaign || '') + '&variant=' + (_idl.variant || 'modal');
        	document.getElementsByTagName('body')[0].appendChild(idl);
        })();
      </script>
    </div>
  </body>
</html>